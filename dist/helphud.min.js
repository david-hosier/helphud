/*! helphud 22-01-2014 */
!function(a,b,c){var d=function(){var a,b;1==arguments.length?(b=arguments[0],b instanceof d?(this.left=b.left,this.top=b.top,this.width=b.width,this.height=b.height):(a=b.offset(),this.left=a.left,this.top=a.top,this.width=b.outerWidth(),this.height=b.outerHeight())):4==arguments.length&&(this.left=arguments[0],this.top=arguments[1],this.width=arguments[2],this.height=arguments[3])};d.prototype.explode=function(a){return this.left-=a,this.top-=a,this.width+=2*a,this.height+=2*a,this},d.prototype.intersection=function(a){var b=this,c=a,e=Math.max(b.left,c.left),f=Math.min(b.left+b.width,c.left+c.width);if(f>=e){var g=Math.max(b.top,c.top),h=Math.min(b.top+b.height,c.top+c.height);if(h>=g)return new d(e,g,f-e,h-g)}return null},d.prototype.subtract=function(a){var b,c=this,e=a;if(null===c.intersection(e))return[new d(c)];b=[];var f=c.top,g=c.height,h=c.left+c.width,i=c.top+c.height,j=e.left+e.width,k=e.top+e.height;return e.top>c.top&&(b.push(new d(c.left,c.top,c.width,e.top-c.top)),f=e.top,g-=e.top-c.top),i>k&&(b.push(new d(c.left,k,c.width,i-k)),g=k-f),e.left>c.left&&b.push(new d(c.left,f,e.left-c.left,g)),h>j&&b.push(new d(j,f,h-j,g)),b},d.prototype.toString=function(){return"[Rect left="+this.left+", top="+this.top+", width="+this.width+", height="+this.height+"]"};var e=function(a){a instanceof d||(a=new d(a)),this.rects=[a]};e.prototype.each=function(a){for(var b=0;b<this.rects.length;b++)a.call(this,this.rects[b])},e.prototype.subtract=function(a){var b=[];a instanceof d||(a=new d(a)),this.each(function(c){for(var d=c.subtract(a),e=0;e<d.length;e++)b.push(d[e])}),this.rects=b},e.prototype.toString=function(){var a="[Plane ";return this.each(function(b){a+=b.toString()+" "}),a+"]"};var f=function(a,b){var d;return function(){d&&c.clearTimeout(d),d=c.setTimeout(function(){d=void 0,b()},a)}},g=function(){var b=a(".helphud-overlay"),c=b.data("container");c.removeClass("helphud-shown").trigger(a.Event("helphud-hidden")),b.fadeOut({complete:function(){h.apply(this,arguments)}})},h=function(){a(c).off(".helphud");var b=a(".helphud-overlay");b.data("container"),b.find(".helphud-panel").each(function(){var b=a(this),c=b.data("marker");b.toggle(!1),c.before(b).remove()}),b.data("more")&&k(b.data("more")),b.find(".helphud-tooltip,[data-from]").each(function(){var b=a(this),c=a(b.data("from"));b.contents().each(function(){c.append(this)})}),b.remove()},i=function(b){b.css({position:"absolute",top:Math.max(0,(a(c).height()-b.outerHeight())/2+a(c).scrollTop())+"px",left:Math.max(0,(a(c).width()-b.outerWidth())/2+a(c).scrollLeft())+"px"})},j=function(b){var c=a(".helphud-overlay");c.data("more",b);var d=a("<div class='helphud-more-mask'></div>");c.append(d),d.height(c.height()).bind("click",k);var e=a("<div class='helphud-more-container'><div class='helphud-more-body'></div><div class='helphud-more-commands'><a class='helphud-more-close' href='#'>Close</a></div></div>"),f=e.find(".helphud-more-body"),g=a("<div class='helphud-marker'></div>"),h=a("#"+b);h.trigger(a.Event("helphud-shown")).data("marker",g).before(g).removeClass("helphud-more"),f.append(h),c.append(e),i(e)},k=function(){var b=a(".helphud-overlay"),c=a("#"+b.data("more")),d=c.data("marker");c.trigger(a.Event("helphud-hidden")),d.before(c).remove(),c.removeData("marker").addClass("helphud-more"),b.find(".helphud-more-mask").remove(),b.find(".helphud-more-container").remove(),b.removeData("more")},l=function(){var b=this;m.apply(this,arguments),a(".helphud-overlay").toggle(!1).fadeIn({complete:function(){b.addClass("helphud-shown").trigger(a.Event("helphud-shown"))}})},m=function(){var i={margin:3,stick:30,barrier:5},l=a("body"),n=this,o=new e(n),p=n.find("*[data-intro]:visible"),q=a("<div class='helphud-overlay'></div>");q.height(Math.max(a(b).height(),a(c).height())),q.on("click",function(b){var c,d=a(b.target),e=d.add(d.parentsUntil(".helphud-overlay"));if(e.each(function(){return c=a(this).data("more"),void 0===c}),c)return j(c),b.preventDefault(),void 0;var f=!1;if(e.each(function(){return f=a(this).hasClass("helphud-more-close"),f===!1}),f)return k(),b.preventDefault(),void 0;var h=d.hasClass("helphud-ignore")||d.parents(".helphud-ignore").length>0||d.hasClass("helphud-more-container")||d.parents(".helphud-more-container").length>0||d.hasClass("helphud-more-mask");h===!1&&g()}),q.data("container",n),l.append(q),p.each(function(){a(this).data("highlight")!==!1&&o.subtract(new d(a(this)).explode(i.margin))}),o.each(function(b){var c=a("<div class='helphud-mask'></div>");c.css({left:b.left,top:b.top,width:b.width,height:b.height}),q.append(c)}),p.each(function(){var b=a(this),c=b.offset(),d=c.left-i.margin,e=c.top-i.margin,f=b.outerWidth()+2*i.margin,g=b.outerHeight()+2*i.margin,h=b.data("position")||"bottom",j=a("<div class='helphud-pointer' ></div>");switch(h){case"left":j.css({top:e,left:d-i.stick-i.barrier+"px",width:i.stick+"px",height:g}).addClass("helphud-pointer-left");break;case"right":j.css({top:e,left:d+f+i.barrier+"px",width:i.stick+"px",height:g}).addClass("helphud-pointer-right");break;case"top":j.css({top:e-i.stick-i.barrier+"px",left:d+"px",width:f+"px",height:i.stick+"px"}).addClass("helphud-pointer-top");break;case"center":j=void 0;break;default:j.css({top:e+g+i.barrier+"px",left:d+"px",width:f+"px",height:i.stick+"px"}).addClass("helphud-pointer-bottom")}j&&q.append(j);var k=a("<div class='helphud-tooltip' style='left:-10000px'></div>"),l=b.data("intro");switch(l.length>0&&"#"===l.charAt(0)?(a(l).contents().each(function(){k.append(this)}),k.data("from",l)):k.html(b.data("intro")),q.append(k),h){case"left":k.css({top:e+g/2-k.outerHeight()/2+"px",left:d-i.barrier-i.stick-k.outerWidth()+"px"});break;case"right":k.css({top:e+g/2-k.outerHeight()/2+"px",left:d+f+i.barrier+i.stick+"px"});break;case"top":k.css({top:e-i.barrier-i.stick-k.outerHeight()+"px",left:d+f/2-k.outerWidth()/2+"px"});break;case"center":k.css({top:e+g/2-k.outerHeight()/2+"px",left:d+f/2-k.outerWidth()/2+"px"});break;default:k.css({top:e+g+i.barrier+i.stick+"px",left:d+f/2-k.outerWidth()/2+"px"})}}),q.data("more")&&j(q.data("more")),n.find(".helphud-panel").each(function(){var b=a(this);if(b.parent().is(":visible")){var c=a("<div class='helphud-marker'></div>");a(this).data("marker",c).before(c).appendTo(q).toggle(!0)}});var r=function(){var b=q.data("more");h.apply(n),m.apply(n),a(".helphud-overlay").toggle(!0),b&&j(b)};a(c).on("resize.helphud",f(100,r)).on("scroll.helphud",f(100,r))},n={show:l,hide:g};a.fn.helphud=function(b){return n[b]?n[b].apply(this,Array.prototype.slice.call(arguments,1)):(a.error("Method "+b+" does not exist on jQuery.helphud"),void 0)}}(jQuery,document,window);